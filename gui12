-- Ultimate Roblox UI Designer Pro
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")
local TextService = game:GetService("TextService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Modern color palette
local colors = {
    background = Color3.fromRGB(28, 30, 38),
    primary = Color3.fromRGB(65, 140, 220),
    secondary = Color3.fromRGB(80, 90, 110),
    accent = Color3.fromRGB(240, 90, 90),
    text = Color3.fromRGB(240, 240, 240),
    darkText = Color3.fromRGB(30, 30, 30),
    success = Color3.fromRGB(80, 200, 120),
    warning = Color3.fromRGB(220, 180, 60),
    error = Color3.fromRGB(220, 80, 80),
    highlight = Color3.fromRGB(100, 180, 255),
    panel = Color3.fromRGB(40, 42, 50)
}

-- Main UI Designer GUI
local designerGui = Instance.new("ScreenGui")
designerGui.Name = "UIDesignerPro"
designerGui.ResetOnSpawn = false
designerGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
designerGui.Parent = game:GetService("CoreGui")

-- Main Container with Glass Morphism Effect
local mainContainer = Instance.new("Frame")
mainContainer.Name = "MainContainer"
mainContainer.Size = UDim2.new(0, 520, 0, 700)
mainContainer.Position = UDim2.new(0.5, -260, 0.5, -350)
mainContainer.BackgroundColor3 = colors.background
mainContainer.BackgroundTransparency = 0.05
mainContainer.BorderSizePixel = 0
mainContainer.Parent = designerGui

-- Corner radius
local containerCorner = Instance.new("UICorner")
containerCorner.CornerRadius = UDim.new(0, 14)
containerCorner.Parent = mainContainer

-- Stroke
local containerStroke = Instance.new("UIStroke")
containerStroke.Color = Color3.fromRGB(80, 90, 110)
containerStroke.Thickness = 1
containerStroke.Transparency = 0.5
containerStroke.Parent = mainContainer

-- Drop Shadow
local shadow = Instance.new("ImageLabel")
shadow.Name = "Shadow"
shadow.Size = UDim2.new(1, 24, 1, 24)
shadow.Position = UDim2.new(0, -12, 0, -12)
shadow.Image = "rbxassetid://1316045217"
shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
shadow.ImageTransparency = 0.8
shadow.ScaleType = Enum.ScaleType.Slice
shadow.SliceCenter = Rect.new(10, 10, 118, 118)
shadow.ZIndex = -1
shadow.Parent = mainContainer

-- Title Bar with Gradient
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 42)
titleBar.BackgroundColor3 = colors.primary
titleBar.BorderSizePixel = 0
titleBar.Parent = mainContainer

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 14)
titleCorner.Parent = titleBar

-- Fix top corners
local cornerFix = Instance.new("Frame")
cornerFix.Size = UDim2.new(1, 0, 0, 14)
cornerFix.Position = UDim2.new(0, 0, 1, -14)
cornerFix.BackgroundColor3 = colors.primary
cornerFix.BorderSizePixel = 0
cornerFix.Parent = titleBar

-- Title Text with Icon
local titleText = Instance.new("TextLabel")
titleText.Name = "TitleText"
titleText.Size = UDim2.new(1, -100, 1, 0)
titleText.Position = UDim2.new(0, 15, 0, 0)
titleText.Text = "üé® UI Designer Pro"
titleText.TextColor3 = colors.text
titleText.BackgroundTransparency = 1
titleText.Font = Enum.Font.GothamBold
titleText.TextSize = 16
titleText.TextXAlignment = Enum.TextXAlignment.Left
titleText.Parent = titleBar

-- Control Buttons
local controlButtons = Instance.new("Frame")
controlButtons.Name = "ControlButtons"
controlButtons.Size = UDim2.new(0, 80, 0, 30)
controlButtons.Position = UDim2.new(1, -90, 0, 6)
controlButtons.BackgroundTransparency = 1
controlButtons.Parent = titleBar

-- Minimize Button
local minimizeButton = Instance.new("TextButton")
minimizeButton.Name = "MinimizeButton"
minimizeButton.Size = UDim2.new(0, 30, 0, 30)
minimizeButton.Position = UDim2.new(0, 0, 0, 0)
minimizeButton.Text = "‚îÄ"
minimizeButton.TextColor3 = colors.text
minimizeButton.BackgroundColor3 = colors.secondary
minimizeButton.Font = Enum.Font.GothamBold
minimizeButton.TextSize = 16
minimizeButton.Parent = controlButtons

local minimizeCorner = Instance.new("UICorner")
minimizeCorner.CornerRadius = UDim.new(0, 6)
minimizeCorner.Parent = minimizeButton

-- Close Button
local closeButton = Instance.new("TextButton")
closeButton.Name = "CloseButton"
closeButton.Size = UDim2.new(0, 30, 0, 30)
closeButton.Position = UDim2.new(0, 40, 0, 0)
closeButton.Text = "‚úï"
closeButton.TextColor3 = colors.text
closeButton.BackgroundColor3 = colors.accent
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 14
closeButton.Parent = controlButtons

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 6)
closeCorner.Parent = closeButton

-- Button hover effects
local function addHoverEffect(button, hoverColor, normalColor)
    button.MouseEnter:Connect(function()
        local tween = TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = hoverColor})
        tween:Play()
    end)
    
    button.MouseLeave:Connect(function()
        local tween = TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = normalColor})
        tween:Play()
    end)
end

addHoverEffect(closeButton, Color3.fromRGB(250, 100, 100), colors.accent)
addHoverEffect(minimizeButton, Color3.fromRGB(100, 110, 130), colors.secondary)

-- Tab Bar
local tabBar = Instance.new("Frame")
tabBar.Name = "TabBar"
tabBar.Size = UDim2.new(1, 0, 0, 50)
tabBar.Position = UDim2.new(0, 0, 0, 42)
tabBar.BackgroundColor3 = colors.panel
tabBar.BorderSizePixel = 0
tabBar.Parent = mainContainer

local tabIndicator = Instance.new("Frame")
tabIndicator.Name = "TabIndicator"
tabIndicator.Size = UDim2.new(0.2, 0, 0, 4)
tabIndicator.Position = UDim2.new(0, 0, 1, -4)
tabIndicator.BackgroundColor3 = colors.primary
tabIndicator.BorderSizePixel = 0
tabIndicator.Parent = tabBar

-- Tabs
local tabs = {
    {name = "Create", icon = "üõ†Ô∏è"},
    {name = "Properties", icon = "üìù"},
    {name = "Scripts", icon = "üíª"},
    {name = "Settings", icon = "‚öôÔ∏è"}
}

local tabButtons = {}
for i, tab in ipairs(tabs) do
    local tabButton = Instance.new("TextButton")
    tabButton.Name = tab.name .. "Tab"
    tabButton.Size = UDim2.new(0.2, 0, 1, 0)
    tabButton.Position = UDim2.new((i-1) * 0.2, 0, 0, 0)
    tabButton.Text = tab.icon .. " " .. tab.name
    tabButton.TextColor3 = i == 1 and colors.primary or Color3.fromRGB(180, 180, 180)
    tabButton.BackgroundTransparency = 1
    tabButton.Font = Enum.Font.GothamBold
    tabButton.TextSize = 14
    tabButton.Parent = tabBar
    
    tabButtons[tab.name] = tabButton
end

-- Content Frame
local contentFrame = Instance.new("Frame")
contentFrame.Name = "ContentFrame"
contentFrame.Size = UDim2.new(1, -20, 1, -112)
contentFrame.Position = UDim2.new(0, 10, 0, 102)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainContainer

-- Tab Contents
local tabContents = {}
for i, tab in ipairs(tabs) do
    local tabContent = Instance.new("ScrollingFrame")
    tabContent.Name = tab.name .. "Content"
    tabContent.Size = UDim2.new(1, 0, 1, 0)
    tabContent.BackgroundTransparency = 1
    tabContent.ScrollBarThickness = 8
    tabContent.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 100)
    tabContent.BorderSizePixel = 0
    tabContent.CanvasSize = UDim2.new(0, 0, 0, 0)
    tabContent.Visible = i == 1
    tabContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
    tabContent.Parent = contentFrame
    
    local layout = Instance.new("UIListLayout")
    layout.Padding = UDim.new(0, 10)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Parent = tabContent
    
    tabContents[tab.name] = tabContent
end

-- Dragging functionality for main window
local dragging = false
local dragStart = nil
local startPos = nil

local function onMainDragStart(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainContainer.Position
        
        -- Animate button press
        local tween = TweenService:Create(mainContainer, TweenInfo.new(0.1), {Size = UDim2.new(0, 515, 0, 695)})
        tween:Play()
    end
end

local function onMainDrag(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        mainContainer.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end

local function onMainDragEnd(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
        
        -- Animate button release
        local tween = TweenService:Create(mainContainer, TweenInfo.new(0.1), {Size = UDim2.new(0, 520, 0, 700)})
        tween:Play()
    end
end

titleBar.InputBegan:Connect(onMainDragStart)
UserInputService.InputChanged:Connect(onMainDrag)
UserInputService.InputEnded:Connect(onMainDragEnd)

-- Minimize functionality
local isMinimized = false
local originalSize = mainContainer.Size

minimizeButton.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    if isMinimized then
        originalSize = mainContainer.Size
        local tween = TweenService:Create(mainContainer, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {Size = UDim2.new(0, 520, 0, 42)})
        tween:Play()
        minimizeButton.Text = "+"
    else
        local tween = TweenService:Create(mainContainer, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {Size = originalSize})
        tween:Play()
        minimizeButton.Text = "‚îÄ"
    end
end)

closeButton.MouseButton1Click:Connect(function()
    local tween = TweenService:Create(mainContainer, TweenInfo.new(0.2), {Size = UDim2.new(0, 0, 0, 0)})
    tween:Play()
    tween.Completed:Wait()
    designerGui:Destroy()
end)

-- Tab switching function
local currentTab = "Create"

local function switchTab(tabName)
    currentTab = tabName
    
    -- Update tab buttons
    for name, button in pairs(tabButtons) do
        button.TextColor3 = name == tabName and colors.primary or Color3.fromRGB(180, 180, 180)
    end
    
    -- Get tab index
    local tabIndex = 0
    for i, tab in ipairs(tabs) do
        if tab.name == tabName then
            tabIndex = i - 1
            break
        end
    end
    
    -- Update tab indicator position
    local indicatorTween = TweenService:Create(tabIndicator, TweenInfo.new(0.2), {
        Position = UDim2.new(tabIndex * 0.2, 0, 1, -4)
    })
    indicatorTween:Play()
    
    -- Update tab visibility
    for name, content in pairs(tabContents) do
        content.Visible = name == tabName
    end
end

-- Connect tab buttons
for name, button in pairs(tabButtons) do
    button.MouseButton1Click:Connect(function()
        switchTab(name)
    end)
end

-- Create UI Elements
local createElements = {
    Frame = {
        Name = "Frame",
        Icon = "‚¨ú",
        Description = "Basic container frame"
    },
    TextLabel = {
        Name = "TextLabel",
        Icon = "üìù",
        Description = "Display text to users"
    },
    TextButton = {
        Name = "TextButton",
        Icon = "üîò",
        Description = "Interactive button element"
    },
    TextBox = {
        Name = "TextBox",
        Icon = "‚úèÔ∏è",
        Description = "Text input field"
    },
    ImageLabel = {
        Name = "ImageLabel",
        Icon = "üñºÔ∏è",
        Description = "Display images"
    },
    ScrollingFrame = {
        Name = "ScrollingFrame",
        Icon = "üìú",
        Description = "Scrollable container"
    }
}

-- Populate Create Tab
local createContent = tabContents["Create"]
local yPos = 10

for elementType, properties in pairs(createElements) do
    local button = Instance.new("TextButton")
    button.Name = elementType .. "Button"
    button.Size = UDim2.new(1, -20, 0, 80)
    button.Position = UDim2.new(0, 10, 0, yPos)
    button.Text = ""
    button.TextColor3 = colors.text
    button.BackgroundColor3 = Color3.fromRGB(40, 45, 55)
    button.BorderSizePixel = 0
    button.Font = Enum.Font.Gotham
    button.TextSize = 12
    button.LayoutOrder = yPos
    button.Parent = createContent
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 10)
    buttonCorner.Parent = button
    
    local buttonStroke = Instance.new("UIStroke")
    buttonStroke.Color = Color3.fromRGB(60, 70, 80)
    buttonStroke.Thickness = 2
    buttonStroke.Parent = button
    
    -- Icon
    local icon = Instance.new("TextLabel")
    icon.Size = UDim2.new(0, 50, 0, 50)
    icon.Position = UDim2.new(0, 15, 0.5, -25)
    icon.Text = properties.Icon
    icon.TextColor3 = colors.primary
    icon.BackgroundTransparency = 1
    icon.Font = Enum.Font.GothamBold
    icon.TextSize = 30
    icon.Parent = button
    
    -- Title
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, -80, 0, 30)
    title.Position = UDim2.new(0, 75, 0, 15)
    title.Text = "Create " .. elementType
    title.TextColor3 = colors.text
    title.BackgroundTransparency = 1
    title.Font = Enum.Font.GothamBold
    title.TextSize = 16
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Parent = button
    
    -- Description
    local desc = Instance.new("TextLabel")
    desc.Size = UDim2.new(1, -80, 0, 30)
    desc.Position = UDim2.new(0, 75, 0, 40)
    desc.Text = properties.Description
    desc.TextColor3 = Color3.fromRGB(180, 180, 180)
    desc.BackgroundTransparency = 1
    desc.Font = Enum.Font.Gotham
    desc.TextSize = 12
    desc.TextXAlignment = Enum.TextXAlignment.Left
    desc.Parent = button
    
    -- Hover effect
    addHoverEffect(button, Color3.fromRGB(50, 55, 65), Color3.fromRGB(40, 45, 55))
    
    button.MouseButton1Click:Connect(function()
        createUIElement(elementType)
    end)
    
    yPos = yPos + 90
end

-- UI Canvas for created elements
local uiCanvas = Instance.new("ScreenGui")
uiCanvas.Name = "UICanvas"
uiCanvas.ResetOnSpawn = false
uiCanvas.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
uiCanvas.Parent = playerGui

-- Currently selected element
local selectedElement = nil
local dragHandleSize = 24 -- Larger handles for better mobile interaction

-- Function to create UI elements
function createUIElement(elementType)
    local newElement = Instance.new(elementType)
    newElement.Name = "New" .. elementType
    newElement.Parent = uiCanvas
    
    -- Set default properties based on element type
    if elementType == "Frame" then
        newElement.Size = UDim2.new(0, 200, 0, 200)
        newElement.Position = UDim2.new(0.5, -100, 0.5, -100)
        newElement.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
        newElement.BorderSizePixel = 0
        
        -- Add default styling
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = newElement
        
        local stroke = Instance.new("UIStroke")
        stroke.Color = Color3.fromRGB(100, 100, 120)
        stroke.Thickness = 2
        stroke.Parent = newElement
    elseif elementType == "TextLabel" then
        newElement.Size = UDim2.new(0, 200, 0, 60)
        newElement.Position = UDim2.new(0.5, -100, 0.5, -30)
        newElement.BackgroundColor3 = Color3.fromRGB(80, 80, 120)
        newElement.Text = "Text Label"
        newElement.TextColor3 = Color3.fromRGB(255, 255, 255)
        newElement.TextSize = 16
        newElement.Font = Enum.Font.Gotham
        newElement.BorderSizePixel = 0
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = newElement
    elseif elementType == "TextButton" then
        newElement.Size = UDim2.new(0, 200, 0, 60)
        newElement.Position = UDim2.new(0.5, -100, 0.5, -30)
        newElement.BackgroundColor3 = Color3.fromRGB(60, 120, 200)
        newElement.Text = "Click Me"
        newElement.TextColor3 = Color3.fromRGB(255, 255, 255)
        newElement.TextSize = 16
        newElement.Font = Enum.Font.Gotham
        newElement.BorderSizePixel = 0
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = newElement
    elseif elementType == "ImageLabel" then
        newElement.Size = UDim2.new(0, 200, 0, 200)
        newElement.Position = UDim2.new(0.5, -100, 0.5, -100)
        newElement.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
        newElement.BorderSizePixel = 0
        newElement.Image = "rbxassetid://111490672" -- Default placeholder image
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = newElement
    else
        newElement.Size = UDim2.new(0, 200, 0, 200)
        newElement.Position = UDim2.new(0.5, -100, 0.5, -100)
        newElement.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
        newElement.BorderSizePixel = 0
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = newElement
    end
    
    -- Make element draggable and resizable
    setupElementControls(newElement)
    
    -- Select the new element
    selectElement(newElement)
    
    -- Switch to properties tab
    switchTab("Properties")
end

-- Function to set up dragging and resizing for elements
function setupElementControls(element)
    local dragging = false
    local dragStart = nil
    local startPos = nil
    
    local resizing = false
    local resizeStart = nil
    local startSize = nil
    local resizeHandle = nil
    
    -- Create drag handles
    local dragHandles = {}
    
    -- Top-left handle
    local topLeft = createDragHandle("TopLeft", UDim2.new(0, -dragHandleSize/2, 0, -dragHandleSize/2))
    topLeft.Parent = element
    
    -- Top-right handle
    local topRight = createDragHandle("TopRight", UDim2.new(1, -dragHandleSize/2, 0, -dragHandleSize/2))
    topRight.Parent = element
    
    -- Bottom-left handle
    local bottomLeft = createDragHandle("BottomLeft", UDim2.new(0, -dragHandleSize/2, 1, -dragHandleSize/2))
    bottomLeft.Parent = element
    
    -- Bottom-right handle
    local bottomRight = createDragHandle("BottomRight", UDim2.new(1, -dragHandleSize/2, 1, -dragHandleSize/2))
    bottomRight.Parent = element
    
    -- Function to update handle positions
    local function updateHandles()
        topLeft.Position = UDim2.new(0, -dragHandleSize/2, 0, -dragHandleSize/2)
        topRight.Position = UDim2.new(1, -dragHandleSize/2, 0, -dragHandleSize/2)
        bottomLeft.Position = UDim2.new(0, -dragHandleSize/2, 1, -dragHandleSize/2)
        bottomRight.Position = UDim2.new(1, -dragHandleSize/2, 1, -dragHandleSize/2)
    end
    
    updateHandles()
    
    -- Dragging functionality
    element.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = element.Position
            selectElement(element)
        end
    end)
    
    -- Resizing functionality
    local function handleResize(handle, input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            resizing = true
            resizeHandle = handle
            resizeStart = input.Position
            startSize = element.Size
            startPos = element.Position
            selectElement(element)
        end
    end
    
    topLeft.InputBegan:Connect(function(input) handleResize("TopLeft", input) end)
    topRight.InputBegan:Connect(function(input) handleResize("TopRight", input) end)
    bottomLeft.InputBegan:Connect(function(input) handleResize("BottomLeft", input) end)
    bottomRight.InputBegan:Connect(function(input) handleResize("BottomRight", input) end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            element.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
        
        if resizing and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - resizeStart
            local newSize = startSize
            
            if resizeHandle == "TopLeft" then
                newSize = UDim2.new(
                    newSize.X.Scale, math.max(40, newSize.X.Offset - delta.X),
                    newSize.Y.Scale, math.max(40, newSize.Y.Offset - delta.Y)
                )
                element.Position = UDim2.new(
                    startPos.X.Scale, startPos.X.Offset + delta.X,
                    startPos.Y.Scale, startPos.Y.Offset + delta.Y
                )
            elseif resizeHandle == "TopRight" then
                newSize = UDim2.new(
                    newSize.X.Scale, math.max(40, newSize.X.Offset + delta.X),
                    newSize.Y.Scale, math.max(40, newSize.Y.Offset - delta.Y)
                )
                element.Position = UDim2.new(
                    startPos.X.Scale, startPos.X.Offset,
                    startPos.Y.Scale, startPos.Y.Offset + delta.Y
                )
            elseif resizeHandle == "BottomLeft" then
                newSize = UDim2.new(
                    newSize.X.Scale, math.max(40, newSize.X.Offset - delta.X),
                    newSize.Y.Scale, math.max(40, newSize.Y.Offset + delta.Y)
                )
                element.Position = UDim2.new(
                    startPos.X.Scale, startPos.X.Offset + delta.X,
                    startPos.Y.Scale, startPos.Y.Offset
                )
            elseif resizeHandle == "BottomRight" then
                newSize = UDim2.new(
                    newSize.X.Scale, math.max(40, newSize.X.Offset + delta.X),
                    newSize.Y.Scale, math.max(40, newSize.Y.Offset + delta.Y)
                )
            end
            
            element.Size = newSize
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
            resizing = false
        end
    end)
    
    -- Update handles when element changes size
    element:GetPropertyChangedSignal("Size"):Connect(updateHandles)
end

-- Create a drag handle
function createDragHandle(name, position)
    local handle = Instance.new("Frame")
    handle.Name = name
    handle.Size = UDim2.new(0, dragHandleSize, 0, dragHandleSize)
    handle.Position = position
    handle.BackgroundColor3 = colors.highlight
    handle.BorderSizePixel = 0
    handle.ZIndex = 100
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(1, 0)
    corner.Parent = handle
    
    -- Add hover effect to handles
    handle.MouseEnter:Connect(function()
        TweenService:Create(handle, TweenInfo.new(0.2), {Size = UDim2.new(0, dragHandleSize+6, 0, dragHandleSize+6)}):Play()
    end)
    
    handle.MouseLeave:Connect(function()
        TweenService:Create(handle, TweenInfo.new(0.2), {Size = UDim2.new(0, dragHandleSize, 0, dragHandleSize)}):Play()
    end)
    
    return handle
end

-- Function to select an element
function selectElement(element)
    -- Remove selection from previous element
    if selectedElement then
        if selectedElement:FindFirstChild("SelectionBox") then
            selectedElement.SelectionBox:Destroy()
        end
    end
    
    selectedElement = element
    
    if not element then
        updatePropertiesTab()
        return
    end
    
    -- Add selection indicator
    local selectionBox = Instance.new("SelectionBox")
    selectionBox.Name = "SelectionBox"
    selectionBox.Adornee = element
    selectionBox.Color3 = colors.primary
    selectionBox.LineThickness = 0.1
    selectionBox.Parent = element
    
    -- Update properties tab
    updatePropertiesTab()
end

-- Create a property panel section
function createSection(parent, title, yPos)
    local sectionFrame = Instance.new("Frame")
    sectionFrame.Size = UDim2.new(1, -20, 0, 40)
    sectionFrame.Position = UDim2.new(0, 10, 0, yPos)
    sectionFrame.BackgroundColor3 = colors.panel
    sectionFrame.BorderSizePixel = 0
    sectionFrame.LayoutOrder = yPos
    sectionFrame.Parent = parent
    
    local sectionCorner = Instance.new("UICorner")
    sectionCorner.CornerRadius = UDim.new(0, 8)
    sectionCorner.Parent = sectionFrame
    
    local sectionStroke = Instance.new("UIStroke")
    sectionStroke.Color = Color3.fromRGB(60, 70, 80)
    sectionStroke.Thickness = 1
    sectionStroke.Parent = sectionFrame
    
    local sectionLabel = Instance.new("TextLabel")
    sectionLabel.Size = UDim2.new(1, -20, 1, 0)
    sectionLabel.Position = UDim2.new(0, 10, 0, 0)
    sectionLabel.Text = title
    sectionLabel.TextColor3 = colors.primary
    sectionLabel.BackgroundTransparency = 1
    sectionLabel.Font = Enum.Font.GothamBold
    sectionLabel.TextSize = 16
    sectionLabel.TextXAlignment = Enum.TextXAlignment.Left
    sectionLabel.Parent = sectionFrame
    
    return sectionFrame
end

-- Update Properties Tab
function updatePropertiesTab()
    local propertiesContent = tabContents["Properties"]
    propertiesContent:ClearAllChildren()
    
    if not selectedElement then
        local noSelection = Instance.new("TextLabel")
        noSelection.Size = UDim2.new(1, -20, 0, 50)
        noSelection.Position = UDim2.new(0, 10, 0, 10)
        noSelection.Text = "‚ùå No element selected"
        noSelection.TextColor3 = colors.error
        noSelection.BackgroundTransparency = 1
        noSelection.Font = Enum.Font.GothamBold
        noSelection.TextSize = 16
        noSelection.TextXAlignment = Enum.TextXAlignment.Center
        noSelection.LayoutOrder = 1
        noSelection.Parent = propertiesContent
        return
    end
    
    local yPos = 10
    
    -- Element Info section
    local infoSection = createSection(propertiesContent, "üìù Element Info", yPos)
    yPos += 50
    
    local infoLabel = Instance.new("TextLabel")
    infoLabel.Size = UDim2.new(1, -20, 0, 30)
    infoLabel.Position = UDim2.new(0, 10, 0, 5)
    infoLabel.Text = "Editing: " .. selectedElement.ClassName .. " (" .. selectedElement.Name .. ")"
    infoLabel.TextColor3 = colors.text
    infoLabel.BackgroundTransparency = 1
    infoLabel.Font = Enum.Font.Gotham
    infoLabel.TextSize = 14
    infoLabel.TextXAlignment = Enum.TextXAlignment.Left
    infoLabel.Parent = infoSection
    
    -- Transform section
    local transformSection = createSection(propertiesContent, "üìê Transform", yPos)
    yPos += 50
    
    createPropertyInput(transformSection, "Name", selectedElement.Name, 10, function(value)
        selectedElement.Name = value
        infoLabel.Text = "Editing: " .. selectedElement.ClassName .. " (" .. selectedElement.Name .. ")"
    end)
    
    createVector2Input(transformSection, "Position", 
        selectedElement.Position.X.Offset, selectedElement.Position.Y.Offset, 
        50, function(x, y)
            selectedElement.Position = UDim2.new(0, x, 0, y)
    end)
    
    createVector2Input(transformSection, "Size", 
        selectedElement.Size.X.Offset, selectedElement.Size.Y.Offset, 
        120, function(w, h)
            selectedElement.Size = UDim2.new(0, w, 0, h)
    end)
    
    -- Appearance section
    local appearanceSection = createSection(propertiesContent, "üé® Appearance", yPos)
    yPos += 50
    
    createColorPicker(appearanceSection, "Background Color", 
        selectedElement.BackgroundColor3, 10, function(color)
            selectedElement.BackgroundColor3 = color
    end)
    
    createSlider(appearanceSection, "Transparency", 
        selectedElement.BackgroundTransparency, 0, 1, 110, function(value)
            selectedElement.BackgroundTransparency = value
    end)
    
    createSlider(appearanceSection, "Border Size", 
        selectedElement.BorderSizePixel, 0, 10, 180, function(value)
            selectedElement.BorderSizePixel = value
    end)
    
    createToggle(appearanceSection, "Visible", 
        selectedElement.Visible, 250, function(value)
            selectedElement.Visible = value
    end)
    
    createToggle(appearanceSection, "Reset on Spawn", 
        selectedElement.ResetOnSpawn, 310, function(value)
            selectedElement.ResetOnSpawn = value
    end)
    
    -- Text-specific properties
    if selectedElement:IsA("TextLabel") or selectedElement:IsA("TextButton") or selectedElement:IsA("TextBox") then
        local textSection = createSection(propertiesContent, "üî§ Text Properties", yPos)
        yPos += 50
        
        createPropertyInput(textSection, "Text", selectedElement.Text, 10, function(value)
            selectedElement.Text = value
        end)
        
        createSlider(textSection, "Text Size", 
            selectedElement.TextSize, 8, 50, 50, function(value)
                selectedElement.TextSize = value
        end)
        
        createColorPicker(textSection, "Text Color", 
            selectedElement.TextColor3, 120, function(color)
                selectedElement.TextColor3 = color
        end)
        
        -- Font selection
        local fonts = {
            "Legacy", "SourceSans", "SourceSansBold", "SourceSansItalic",
            "SourceSansLight", "SourceSansSemibold", "SourceSansBoldItalic",
            "Gotham", "GothamBlack", "GothamBold", "GothamMedium", "GothamLight"
        }
        
        createDropdown(textSection, "Font", 
            selectedElement.Font.Name, fonts, 220, function(value)
                selectedElement.Font = Enum.Font[value]
        end)
        
        -- Text stroke
        createToggle(textSection, "Text Stroke", 
            selectedElement.TextStrokeTransparency < 1, 290, function(value)
                if value then
                    selectedElement.TextStrokeTransparency = 0
                else
                    selectedElement.TextStrokeTransparency = 1
                end
        end)
        
        if selectedElement.TextStrokeTransparency < 1 then
            createSlider(textSection, "Text Stroke Transparency", 
                selectedElement.TextStrokeTransparency, 0, 1, 350, function(value)
                    selectedElement.TextStrokeTransparency = value
            end)
            
            createSlider(textSection, "Text Stroke Thickness", 
                selectedElement.TextStrokeWidth, 1, 10, 420, function(value)
                    selectedElement.TextStrokeWidth = value
            end)
            
            createColorPicker(textSection, "Text Stroke Color", 
                selectedElement.TextStrokeColor3, 490, function(color)
                    selectedElement.TextStrokeColor3 = color
            end)
        end
        
        -- Text wrapping
        createToggle(textSection, "Text Wrapped", 
            selectedElement.TextWrapped, 590, function(value)
                selectedElement.TextWrapped = value
        end)
        
        -- Text scaled
        createToggle(textSection, "Text Scaled", 
            selectedElement.TextScaled, 650, function(value)
                selectedElement.TextScaled = value
        end)
    end
    
    -- ImageLabel-specific properties
    if selectedElement:IsA("ImageLabel") then
        local imageSection = createSection(propertiesContent, "üñºÔ∏è Image Properties", yPos)
        yPos += 50
        
        createPropertyInput(imageSection, "Image ID", selectedElement.Image, 10, function(value)
            selectedElement.Image = value
        end)
        
        createColorPicker(imageSection, "Image Color", 
            selectedElement.ImageColor3, 60, function(color)
                selectedElement.ImageColor3 = color
        end)
        
        -- Scale types
        local scaleTypes = {
            "Stretch", "Slice", "Tile", "Fit", "Crop"
        }
        
        createDropdown(imageSection, "Scale Type", 
            selectedElement.ScaleType.Name, scaleTypes, 160, function(value)
                selectedElement.ScaleType = Enum.ScaleType[value]
        end)
        
        createSlider(imageSection, "Slice Scale", 
            selectedElement.SliceScale, 0.01, 1, 230, function(value)
                selectedElement.SliceScale = value
        end)
        
        createToggle(imageSection, "Tile Background", 
            selectedElement.TileSize.Offset > 0, 300, function(value)
                if value then
                    selectedElement.TileSize = UDim2.new(0, 100, 0, 100)
                else
                    selectedElement.TileSize = UDim2.new(0, 0, 0, 0)
                end
        end)
    end
    
    -- UI Effects section
    local effectsSection = createSection(propertiesContent, "‚ú® UI Effects", yPos)
    yPos += 50
    
    -- Add Corner button
    local cornerBtn = createEffectButton("Add Corner", 10, effectsSection)
    cornerBtn.MouseButton1Click:Connect(function()
        if not selectedElement:FindFirstChildOfClass("UICorner") then
            local corner = Instance.new("UICorner")
            corner.Parent = selectedElement
        end
    end)
    
    -- Add Stroke button
    local strokeBtn = createEffectButton("Add Stroke", 60, effectsSection)
    strokeBtn.MouseButton1Click:Connect(function()
        if not selectedElement:FindFirstChildOfClass("UIStroke") then
            local stroke = Instance.new("UIStroke")
            stroke.Parent = selectedElement
        end
    end)
    
    -- Add Gradient button
    local gradientBtn = createEffectButton("Add Gradient", 110, effectsSection)
    gradientBtn.MouseButton1Click:Connect(function()
        if not selectedElement:FindFirstChildOfClass("UIGradient") then
            local gradient = Instance.new("UIGradient")
            gradient.Parent = selectedElement
        end
    end)
    
    -- Add Shadow button
    local shadowBtn = createEffectButton("Add Shadow", 160, effectsSection)
    shadowBtn.MouseButton1Click:Connect(function()
        if not selectedElement:FindFirstChild("DropShadow") then
            local shadow = Instance.new("ImageLabel")
            shadow.Name = "DropShadow"
            shadow.Size = UDim2.new(1, 20, 1, 20)
            shadow.Position = UDim2.new(0, -10, 0, -10)
            shadow.Image = "rbxassetid://1316045217"
            shadow.ImageColor3 = Color3.new(0, 0, 0)
            shadow.ImageTransparency = 0.7
            shadow.ScaleType = Enum.ScaleType.Slice
            shadow.SliceCenter = Rect.new(10, 10, 118, 118)
            shadow.BackgroundTransparency = 1
            shadow.ZIndex = selectedElement.ZIndex - 1
            shadow.Parent = selectedElement
        end
    end)
end

-- Create a dropdown menu
function createDropdown(parent, name, currentValue, options, yPos, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -20, 0, 50)
    frame.Position = UDim2.new(0, 10, 0, yPos)
    frame.BackgroundTransparency = 1
    frame.LayoutOrder = yPos
    frame.Parent = parent
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.4, 0, 0.5, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.Text = name .. ":"
    label.TextColor3 = colors.text
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame
    
    local dropdown = Instance.new("TextButton")
    dropdown.Size = UDim2.new(0.6, 0, 0.5, 0)
    dropdown.Position = UDim2.new(0.4, 0, 0, 0)
    dropdown.Text = currentValue
    dropdown.TextColor3 = colors.darkText
    dropdown.BackgroundColor3 = Color3.fromRGB(220, 220, 220)
    dropdown.Font = Enum.Font.Gotham
    dropdown.TextSize = 14
    dropdown.Parent = frame
    
    local dropdownCorner = Instance.new("UICorner")
    dropdownCorner.CornerRadius = UDim.new(0, 4)
    dropdownCorner.Parent = dropdown
    
    local dropdownList = Instance.new("Frame")
    dropdownList.Size = UDim2.new(1, 0, 0, 0)
    dropdownList.Position = UDim2.new(0, 0, 1, 5)
    dropdownList.BackgroundColor3 = Color3.fromRGB(240, 240, 240)
    dropdownList.BorderSizePixel = 0
    dropdownList.Visible = false
    dropdownList.Parent = dropdown
    
    local listCorner = Instance.new("UICorner")
    listCorner.CornerRadius = UDim.new(0, 4)
    listCorner.Parent = dropdownList
    
    local listLayout = Instance.new("UIListLayout")
    listLayout.Parent = dropdownList
    
    for _, option in ipairs(options) do
        local optionBtn = Instance.new("TextButton")
        optionBtn.Size = UDim2.new(1, 0, 0, 30)
        optionBtn.Text = option
        optionBtn.TextColor3 = colors.darkText
        optionBtn.BackgroundTransparency = 1
        optionBtn.Font = Enum.Font.Gotham
        optionBtn.TextSize = 14
        optionBtn.Parent = dropdownList
        
        optionBtn.MouseButton1Click:Connect(function()
            dropdown.Text = option
            callback(option)
            dropdownList.Visible = false
        end)
        
        addHoverEffect(optionBtn, Color3.fromRGB(230, 230, 230), Color3.new(1, 1, 1))
    end
    
    dropdown.MouseButton1Click:Connect(function()
        dropdownList.Visible = not dropdownList.Visible
        dropdownList.Size = UDim2.new(1, 0, 0, #options * 30)
    end)
    
    return dropdown
end

-- Create a property input field
function createPropertyInput(parent, name, value, yPos, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -20, 0, 40)
    frame.Position = UDim2.new(0, 10, 0, yPos)
    frame.BackgroundTransparency = 1
    frame.LayoutOrder = yPos
    frame.Parent = parent
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.4, 0, 1, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.Text = name .. ":"
    label.TextColor3 = colors.text
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame
    
    local input = Instance.new("TextBox")
    input.Size = UDim2.new(0.6, 0, 1, 0)
    input.Position = UDim2.new(0.4, 0, 0, 0)
    input.Text = tostring(value)
    input.TextColor3 = colors.darkText
    input.BackgroundColor3 = Color3.fromRGB(220, 220, 220)
    input.BorderSizePixel = 0
    input.Font = Enum.Font.Gotham
    input.TextSize = 14
    input.Parent = frame
    
    local inputCorner = Instance.new("UICorner")
    inputCorner.CornerRadius = UDim.new(0, 4)
    inputCorner.Parent = input
    
    input.FocusLost:Connect(function()
        callback(input.Text)
    end)
end

-- Create a Vector2 input (for position/size)
function createVector2Input(parent, name, x, y, yPos, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -20, 0, 60)
    frame.Position = UDim2.new(0, 10, 0, yPos)
    frame.BackgroundTransparency = 1
    frame.LayoutOrder = yPos
    frame.Parent = parent
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 20)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.Text = name .. ":"
    label.TextColor3 = colors.text
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame
    
    -- X input
    local xLabel = Instance.new("TextLabel")
    xLabel.Size = UDim2.new(0.1, 0, 0, 30)
    xLabel.Position = UDim2.new(0, 0, 0, 25)
    xLabel.Text = "X:"
    xLabel.TextColor3 = colors.text
    xLabel.BackgroundTransparency = 1
    xLabel.Font = Enum.Font.Gotham
    xLabel.TextSize = 14
    xLabel.Parent = frame
    
    local xInput = Instance.new("TextBox")
    xInput.Size = UDim2.new(0.35, 0, 0, 30)
    xInput.Position = UDim2.new(0.1, 0, 0, 25)
    xInput.Text = tostring(x)
    xInput.TextColor3 = colors.darkText
    xInput.BackgroundColor3 = Color3.fromRGB(220, 220, 220)
    xInput.BorderSizePixel = 0
    xInput.Font = Enum.Font.Gotham
    xInput.TextSize = 14
    xInput.Parent = frame
    
    local xCorner = Instance.new("UICorner")
    xCorner.CornerRadius = UDim.new(0, 4)
    xCorner.Parent = xInput
    
    -- Y input
    local yLabel = Instance.new("TextLabel")
    yLabel.Size = UDim2.new(0.1, 0, 0, 30)
    yLabel.Position = UDim2.new(0.5, 0, 0, 25)
    yLabel.Text = "Y:"
    yLabel.TextColor3 = colors.text
    yLabel.BackgroundTransparency = 1
    yLabel.Font = Enum.Font.Gotham
    yLabel.TextSize = 14
    yLabel.Parent = frame
    
    local yInput = Instance.new("TextBox")
    yInput.Size = UDim2.new(0.35, 0, 0, 30)
    yInput.Position = UDim2.new(0.6, 0, 0, 25)
    yInput.Text = tostring(y)
    yInput.TextColor3 = colors.darkText
    yInput.BackgroundColor3 = Color3.fromRGB(220, 220, 220)
    yInput.BorderSizePixel = 0
    yInput.Font = Enum.Font.Gotham
    yInput.TextSize = 14
    yInput.Parent = frame
    
    local yCorner = Instance.new("UICorner")
    yCorner.CornerRadius = UDim.new(0, 4)
    yCorner.Parent = yInput
    
    -- Update callback
    local function update()
        local xVal = tonumber(xInput.Text) or 0
        local yVal = tonumber(yInput.Text) or 0
        callback(xVal, yVal)
    end
    
    xInput.FocusLost:Connect(update)
    yInput.FocusLost:Connect(update)
end

-- Create a color picker
function createColorPicker(parent, name, currentColor, yPos, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -20, 0, 100)
    frame.Position = UDim2.new(0, 10, 0, yPos)
    frame.BackgroundTransparency = 1
    frame.LayoutOrder = yPos
    frame.Parent = parent
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 20)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.Text = name
    label.TextColor3 = colors.text
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame
    
    -- Color preview
    local preview = Instance.new("Frame")
    preview.Size = UDim2.new(0, 60, 0, 30)
    preview.Position = UDim2.new(0, 0, 0, 25)
    preview.BackgroundColor3 = currentColor
    preview.BorderSizePixel = 0
    preview.Parent = frame
    
    local previewCorner = Instance.new("UICorner")
    previewCorner.CornerRadius = UDim.new(0, 4)
    previewCorner.Parent = preview
    
    -- RGB inputs
    local rInput = createNumberInput("R:", math.floor(currentColor.R * 255), UDim2.new(0, 70, 0, 25), frame)
    local gInput = createNumberInput("G:", math.floor(currentColor.G * 255), UDim2.new(0, 70, 0, 60), frame)
    local bInput = createNumberInput("B:", math.floor(currentColor.B * 255), UDim2.new(0, 70, 0, 95), frame)
    
    -- Apply button
    local applyBtn = Instance.new("TextButton")
    applyBtn.Size = UDim2.new(0.3, 0, 0, 30)
    applyBtn.Position = UDim2.new(0.7, 0, 0, 30)
    applyBtn.Text = "Apply"
    applyBtn.TextColor3 = colors.text
    applyBtn.BackgroundColor3 = colors.primary
    applyBtn.BorderSizePixel = 0
    applyBtn.Font = Enum.Font.Gotham
    applyBtn.TextSize = 14
    applyBtn.Parent = frame
    
    local applyCorner = Instance.new("UICorner")
    applyCorner.CornerRadius = UDim.new(0, 4)
    applyCorner.Parent = applyBtn
    
    addHoverEffect(applyBtn, Color3.fromRGB(75, 150, 230), colors.primary)
    
    applyBtn.MouseButton1Click:Connect(function()
        local r = math.clamp(tonumber(rInput.Text) or 0, 0, 255) / 255
        local g = math.clamp(tonumber(gInput.Text) or 0, 0, 255) / 255
        local b = math.clamp(tonumber(bInput.Text) or 0, 0, 255) / 255
        local newColor = Color3.new(r, g, b)
        preview.BackgroundColor3 = newColor
        callback(newColor)
    end)
end

-- Create a number input
function createNumberInput(label, value, position, parent)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0.4, 0, 0, 30)
    frame.Position = position
    frame.BackgroundTransparency = 1
    frame.Parent = parent
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.3, 0, 1, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.Text = label
    label.TextColor3 = colors.text
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame
    
    local input = Instance.new("TextBox")
    input.Size = UDim2.new(0.7, 0, 1, 0)
    input.Position = UDim2.new(0.3, 0, 0, 0)
    input.Text = tostring(value)
    input.TextColor3 = colors.darkText
    input.BackgroundColor3 = Color3.fromRGB(220, 220, 220)
    input.BorderSizePixel = 0
    input.Font = Enum.Font.Gotham
    input.TextSize = 14
    input.Parent = frame
    
    local inputCorner = Instance.new("UICorner")
    inputCorner.CornerRadius = UDim.new(0, 4)
    inputCorner.Parent = input
    
    return input
end

-- Create a slider
function createSlider(parent, name, value, min, max, yPos, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -20, 0, 60)
    frame.Position = UDim2.new(0, 10, 0, yPos)
    frame.BackgroundTransparency = 1
    frame.LayoutOrder = yPos
    frame.Parent = parent
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 20)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.Text = name .. ": " .. string.format("%.2f", value)
    label.TextColor3 = colors.text
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame
    
    local slider = Instance.new("Frame")
    slider.Size = UDim2.new(1, 0, 0, 10)
    slider.Position = UDim2.new(0, 0, 0, 30)
    slider.BackgroundColor3 = Color3.fromRGB(80, 80, 90)
    slider.BorderSizePixel = 0
    slider.Parent = frame
    
    local sliderCorner = Instance.new("UICorner")
    sliderCorner.CornerRadius = UDim.new(1, 0)
    sliderCorner.Parent = slider
    
    local fill = Instance.new("Frame")
    fill.Size = UDim2.new((value - min) / (max - min), 0, 1, 0)
    fill.BackgroundColor3 = colors.primary
    fill.BorderSizePixel = 0
    fill.Parent = slider
    
    local fillCorner = Instance.new("UICorner")
    fillCorner.CornerRadius = UDim.new(1, 0)
    fillCorner.Parent = fill
    
    local handle = Instance.new("Frame")
    handle.Size = UDim2.new(0, 20, 0, 20)
    handle.Position = UDim2.new((value - min) / (max - min), -10, 0.5, -10)
    handle.BackgroundColor3 = colors.highlight
    handle.BorderSizePixel = 0
    handle.Parent = slider
    
    local handleCorner = Instance.new("UICorner")
    handleCorner.CornerRadius = UDim.new(1, 0)
    handleCorner.Parent = handle
    
    local dragging = false
    
    slider.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            updateSlider(input.Position.X)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            updateSlider(input.Position.X)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
    
    function updateSlider(xPos)
        local relativeX = (xPos - slider.AbsolutePosition.X) / slider.AbsoluteSize.X
        relativeX = math.clamp(relativeX, 0, 1)
        local newValue = min + relativeX * (max - min)
        
        fill.Size = UDim2.new(relativeX, 0, 1, 0)
        handle.Position = UDim2.new(relativeX, -10, 0.5, -10)
        label.Text = name .. ": " .. string.format("%.2f", newValue)
        callback(newValue)
    end
end

-- Create a toggle switch
function createToggle(parent, name, value, yPos, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -20, 0, 40)
    frame.Position = UDim2.new(0, 10, 0, yPos)
    frame.BackgroundTransparency = 1
    frame.LayoutOrder = yPos
    frame.Parent = parent
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.Text = name
    label.TextColor3 = colors.text
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame
    
    local toggle = Instance.new("TextButton")
    toggle.Size = UDim2.new(0, 50, 0, 25)
    toggle.Position = UDim2.new(0.7, 0, 0.5, -12.5)
    toggle.Text = ""
    toggle.BackgroundColor3 = value and colors.success or colors.secondary
    toggle.BorderSizePixel = 0
    toggle.Parent = frame
    
    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(1, 0)
    toggleCorner.Parent = toggle
    
    local knob = Instance.new("Frame")
    knob.Size = UDim2.new(0, 20, 0, 20)
    knob.Position = value and UDim2.new(1, -22, 0.5, -10) or UDim2.new(0, 2, 0.5, -10)
    knob.BackgroundColor3 = Color3.fromRGB(240, 240, 240)
    knob.BorderSizePixel = 0
    knob.Parent = toggle
    
    local knobCorner = Instance.new("UICorner")
    knobCorner.CornerRadius = UDim.new(1, 0)
    knobCorner.Parent = knob
    
    toggle.MouseButton1Click:Connect(function()
        local newValue = not value
        toggle.BackgroundColor3 = newValue and colors.success or colors.secondary
        knob.Position = newValue and UDim2.new(1, -22, 0.5, -10) or UDim2.new(0, 2, 0.5, -10)
        callback(newValue)
    end)
end

-- Create an effect button
function createEffectButton(text, yPos, parent)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0.2, -10, 0, 40)
    button.Position = UDim2.new(0, yPos, 0, 5)
    button.Text = text
    button.TextColor3 = colors.text
    button.BackgroundColor3 = colors.secondary
    button.BorderSizePixel = 0
    button.Font = Enum.Font.Gotham
    button.TextSize = 14
    button.Parent = parent
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 6)
    buttonCorner.Parent = button
    
    addHoverEffect(button, Color3.fromRGB(90, 100, 120), colors.secondary)
    
    return button
end

-- Set up scripts tab
local scriptsContent = tabContents["Scripts"]
local scriptEditor = Instance.new("ScrollingFrame")
scriptEditor.Name = "ScriptEditor"
scriptEditor.Size = UDim2.new(1, 0, 1, -100)
scriptEditor.Position = UDim2.new(0, 0, 0, 0)
scriptEditor.BackgroundColor3 = Color3.fromRGB(40, 45, 55)
scriptEditor.BorderSizePixel = 0
scriptEditor.ScrollBarThickness = 8
scriptEditor.CanvasSize = UDim2.new(0, 0, 0, 0)
scriptEditor.AutomaticCanvasSize = Enum.AutomaticSize.Y
scriptEditor.Parent = scriptsContent

local scriptInput = Instance.new("TextBox")
scriptInput.Name = "ScriptInput"
scriptInput.Size = UDim2.new(1, -10, 1, -10)
scriptInput.Position = UDim2.new(0, 5, 0, 5)
scriptInput.Text = "-- Add your script here\n-- Use 'element' to reference the selected element\nprint(\"Button clicked!\")\nelement.Text = \"Clicked!\""
scriptInput.TextColor3 = colors.text
scriptInput.BackgroundTransparency = 1
scriptInput.TextXAlignment = Enum.TextXAlignment.Left
scriptInput.TextYAlignment = Enum.TextYAlignment.Top
scriptInput.Font = Enum.Font.Code
scriptInput.TextSize = 14
scriptInput.TextWrapped = true
scriptInput.MultiLine = true
scriptInput.ClearTextOnFocus = false
scriptInput.Parent = scriptEditor

local applyScriptBtn = Instance.new("TextButton")
applyScriptBtn.Size = UDim2.new(1, -20, 0, 40)
applyScriptBtn.Position = UDim2.new(0, 10, 1, -50)
applyScriptBtn.Text = "üíæ Apply Script to Element"
applyScriptBtn.TextColor3 = colors.text
applyScriptBtn.BackgroundColor3 = colors.success
applyScriptBtn.BorderSizePixel = 0
applyScriptBtn.Font = Enum.Font.GothamBold
applyScriptBtn.TextSize = 14
applyScriptBtn.LayoutOrder = 100
applyScriptBtn.Parent = scriptsContent

local applyCorner = Instance.new("UICorner")
applyCorner.CornerRadius = UDim.new(0, 8)
applyCorner.Parent = applyScriptBtn

addHoverEffect(applyScriptBtn, Color3.fromRGB(90, 210, 130), colors.success)

applyScriptBtn.MouseButton1Click:Connect(function()
    if selectedElement then
        local scriptText = scriptInput.Text
        
        -- Create a new script for the element
        local elementScript = Instance.new("LocalScript")
        elementScript.Name = "CustomScript"
        elementScript.Source = string.format([[
            local element = script.Parent
            %s
        ]], scriptText)
        
        elementScript.Parent = selectedElement
    end
end)

-- Set up settings tab
local settingsContent = tabContents["Settings"]
local settingsYPos = 10

-- Theme selection
local themeLabel = Instance.new("TextLabel")
themeLabel.Size = UDim2.new(1, -20, 0, 30)
themeLabel.Position = UDim2.new(0, 10, 0, settingsYPos)
themeLabel.Text = "üé® Theme Settings"
themeLabel.TextColor3 = colors.text
themeLabel.BackgroundTransparency = 1
themeLabel.Font = Enum.Font.GothamBold
themeLabel.TextSize = 16
themeLabel.TextXAlignment = Enum.TextXAlignment.Left
themeLabel.LayoutOrder = settingsYPos
themeLabel.Parent = settingsContent
settingsYPos = settingsYPos + 40

-- Theme selection dropdown
local themes = {"Dark", "Light", "Blue", "Red", "Green"}
createDropdown(settingsContent, "Color Theme", "Dark", themes, settingsYPos, function(value)
    -- This would update the theme colors in a real implementation
    print("Theme changed to:", value)
end)
settingsYPos = settingsYPos + 60

-- UI Scale
createSlider(settingsContent, "UI Scale", 1, 0.5, 2, settingsYPos, function(value)
    mainContainer.Size = UDim2.new(0, 520 * value, 0, 700 * value)
    mainContainer.Position = UDim2.new(0.5, -260 * value, 0.5, -350 * value)
end)
settingsYPos = settingsYPos + 70

-- Snap to grid
createToggle(settingsContent, "Enable Grid Snapping", true, settingsYPos, function(value)
    print("Grid snapping:", value)
end)
settingsYPos = settingsYPos + 50

createSlider(settingsContent, "Grid Size", 10, 5, 50, settingsYPos, function(value)
    print("Grid size set to:", value)
end)
settingsYPos = settingsYPos + 70

-- Advanced settings
local advancedLabel = Instance.new("TextLabel")
advancedLabel.Size = UDim2.new(1, -20, 0, 30)
advancedLabel.Position = UDim2.new(0, 10, 0, settingsYPos)
advancedLabel.Text = "‚öôÔ∏è Advanced Settings"
advancedLabel.TextColor3 = colors.text
advancedLabel.BackgroundTransparency = 1
advancedLabel.Font = Enum.Font.GothamBold
advancedLabel.TextSize = 16
advancedLabel.TextXAlignment = Enum.TextXAlignment.Left
advancedLabel.LayoutOrder = settingsYPos
advancedLabel.Parent = settingsContent
settingsYPos = settingsYPos + 40

createToggle(settingsContent, "Show Element Outlines", true, settingsYPos, function(value)
    if value then
        containerStroke.Transparency = 0.3
    else
        containerStroke.Transparency = 1
    end
end)
settingsYPos = settingsYPos + 50

createToggle(settingsContent, "Enable Element ZIndex", true, settingsYPos, function(value)
    print("ZIndex enabled:", value)
end)
settingsYPos = settingsYPos + 50

createToggle(settingsContent, "Auto-save Layout", false, settingsYPos, function(value)
    print("Auto-save:", value)
end)
settingsYPos = settingsYPos + 50

-- Keyboard shortcuts
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.Delete and selectedElement then
        selectedElement:Destroy()
        selectedElement = nil
        updatePropertiesTab()
    elseif input.KeyCode == Enum.KeyCode.F1 then
        designerGui.Enabled = not designerGui.Enabled
    elseif input.KeyCode == Enum.KeyCode.Escape then
        selectElement(nil)
    end
end)

-- Mobile compatibility
if UserInputService.TouchEnabled then
    -- Increase sizes for mobile
    mainContainer.Size = UDim2.new(0, 600, 0, 800)
    mainContainer.Position = UDim2.new(0.5, -300, 0.5, -400)
    dragHandleSize = 30
    
    -- Increase button sizes
    for _, button in pairs(controlButtons:GetChildren()) do
        if button:IsA("TextButton") then
            button.Size = UDim2.new(0, 50, 0, 50)
        end
    end
    
    -- Increase font sizes
    titleText.TextSize = 20
    for name, button in pairs(tabButtons) do
        button.TextSize = 16
    end
end

-- Initial notification
local function showNotification(text, color)
    -- Simple notification implementation
    print("UI Designer: " .. text)
end

showNotification("üé® UI Designer Pro loaded! Press F1 to toggle", colors.primary)

-- Make the script return something useful
return {
    gui = designerGui,
    selectElement = function(element)
        selectElement(element)
        switchTab("Properties")
    end,
    getSelectedElement = function()
        return selectedElement
    end
}
